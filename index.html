<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Admin Portal - Live Screen Share</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #007bff; --dark: #121212; --panel: #1e1e1e; }
        body { margin: 0; background: var(--dark); color: white; font-family: sans-serif; overflow: hidden; }

        /* Auth Screen */
        .auth-container { position: fixed; inset: 0; background: var(--dark); z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .auth-card { background: white; color: #333; padding: 30px; border-radius: 15px; width: 320px; text-align: center; }
        .auth-card input { width: 90%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 8px; }
        .auth-card button { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }

        /* Main Layout */
        header { height: 60px; background: #fff; color: #333; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .user-profile { display: flex; align-items: center; gap: 10px; cursor: pointer; font-weight: bold; color: var(--primary); }
        .user-avatar { width: 35px; height: 35px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; }

        .wrapper { display: flex; height: calc(100vh - 60px); }
        .content-area { flex: 1; padding: 30px; display: flex; flex-direction: column; align-items: center; overflow-y: auto; }
        .chat-sidebar { width: 320px; background: #f4f4f4; color: #333; display: flex; flex-direction: column; border-left: 1px solid #ddd; }

        /* Sidebar */
        .swipe-tab { position: fixed; right: -300px; top: 60px; width: 300px; height: 100%; background: var(--panel); transition: 0.3s; z-index: 500; border-left: 2px solid var(--primary); }
        .swipe-tab.active { right: 0; }
        .menu-item { padding: 15px 25px; border-bottom: 1px solid #333; cursor: pointer; color: #ccc; }
        .menu-item:hover { background: #252525; color: white; }

        .page { display: none; width: 100%; max-width: 800px; }
        .page.active { display: block; }
        .card { background: #222; padding: 25px; border-radius: 12px; border: 1px solid #333; }
        
        /* Video Styling */
        #remote-video, #local-video { width: 100%; border-radius: 10px; background: #000; margin-top: 15px; border: 2px solid #444; }
        .share-btn { background: #28a745; color: white; padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .stop-btn { background: #dc3545; color: white; padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; display: none; }

        #chat-msgs { flex: 1; padding: 10px; overflow-y: auto; }
        .msg-bubble { background: white; padding: 8px; margin-bottom: 5px; border-radius: 5px; display: flex; justify-content: space-between; border: 1px solid #ddd; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="auth-screen" class="auth-container">
    <div class="auth-card">
        <h2 id="auth-title">Sign In</h2>
        <input type="text" id="user-id" placeholder="User ID / Name">
        <input type="password" id="user-pass" placeholder="Password">
        <div id="signup-fields" class="hidden"><input type="text" id="user-hint" placeholder="Security Hint"></div>
        <button onclick="handleAuth()" id="auth-btn">Login</button>
        <p onclick="toggleAuthMode()" id="toggle-text" style="cursor:pointer; color:#007bff; margin-top:10px;">Don't have an account? Sign Up</p>
    </div>
</div>

<div id="main-ui" class="hidden">
    <header>
        <div style="font-size: 20px; font-weight: bold;">LIVE PORTAL</div>
        <div class="user-profile" onclick="toggleSidebar()">
            <span id="display-name">Admin User</span>
            <div class="user-avatar" id="avatar-icon">A</div>
        </div>
    </header>

    <div class="wrapper">
        <div class="content-area">
            <div id="page-video" class="page active">
                <div class="card" style="text-align:center;">
                    <h2 style="color:red;">üî¥ Live Streaming</h2>
                    <a id="play-btn" href="#" target="_blank" style="background:red; color:white; padding:15px 40px; border-radius:10px; text-decoration:none; font-weight:bold; display:inline-block;">OPEN VIDEO PLAYER</a>
                    <div style="margin-top:20px;">
                        <input type="text" id="yt-url" style="width:60%; padding:12px; background:#333; color:white; border:none;" placeholder="Paste YouTube Link...">
                        <button onclick="updateLink()" style="padding:12px; background:green; color:white; border:none;">Update</button>
                    </div>
                </div>
            </div>

            <div id="page-screenshare" class="page">
                <div class="card" style="text-align:center;">
                    <h2>üñ•Ô∏è Live Screen Sharing</h2>
                    <p id="share-status">Click start to broadcast your screen to all users.</p>
                    <button id="start-share" class="share-btn" onclick="startCapture()">Start Broadcast</button>
                    <button id="stop-share" class="stop-btn" onclick="stopCapture()">Stop Broadcasting</button>
                    <video id="local-video" autoplay playsinline muted></video>
                </div>
            </div>

            <div id="page-profile" class="page"><div class="card"><h2>üë§ Profile</h2><p>User: <span id="p-name"></span></p></div></div>
            <div id="page-version" class="page"><div class="card"><h2>üì¶ Version</h2><p>v2.1.0 Stable - WebRTC Enabled</p></div></div>
        </div>

        <div class="chat-sidebar">
            <div style="padding:15px; background:#eee; font-weight:bold;">Live Chat</div>
            <div id="chat-msgs"></div>
            <div style="padding:10px; display:flex; gap:5px; border-top:1px solid #ddd;">
                <input type="text" id="c-text" style="flex:1; padding:8px;" placeholder="Type message...">
                <button onclick="sendMsg()" style="padding:8px; background:var(--primary); color:white; border:none; border-radius:5px;">Send</button>
            </div>
        </div>
    </div>
</div>

<div id="sidebar" class="swipe-tab">
    <div style="padding: 20px; font-weight: bold; background: #252525;">MENU</div>
    <div class="menu-item" onclick="showPage('page-profile')">Profile</div>
    <div class="menu-item" onclick="showPage('page-video')">Video</div>
    <div class="menu-item" onclick="showPage('page-screenshare')">Screen Sharing</div>
    <div class="menu-item" onclick="showPage('page-version')">Version</div>
    <div class="menu-item" onclick="logout()" style="color:red;">Logout</div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBRMHSwe81bAULkRMhmBK5sX-6F_aSI2YM",
        authDomain: "weblivestream-3d90a.firebaseapp.com",
        databaseURL: "https://weblivestream-3d90a-default-rtdb.firebaseio.com",
        projectId: "weblivestream-3d90a",
        appId: "1:731300036585:web:08e93ab2c71a7db98b5578"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // --- Screen Share Broadcast Logic ---
    let displayStream = null;
    const localVid = document.getElementById('local-video');

    // Watch for other users sharing
    db.ref('screen_share_status').on('value', (s) => {
        const data = s.val();
        const statusText = document.getElementById('share-status');
        if(data && data.user !== localStorage.getItem('active_user')) {
            statusText.innerHTML = `<b style="color:#28a745;">üî¥ ${data.user} is currently Live!</b>`;
            // In a real app, you'd join a WebRTC room here.
        } else if(!data) {
            statusText.innerText = "No one is sharing right now.";
        }
    });

    async function startCapture() {
        try {
            displayStream = await navigator.mediaDevices.getDisplayMedia({ video: true });
            localVid.srcObject = displayStream;
            
            // Tell everyone I am live
            db.ref('screen_share_status').set({ user: localStorage.getItem('active_user'), active: true });

            document.getElementById('start-share').style.display = 'none';
            document.getElementById('stop-share').style.display = 'inline-block';
            
            displayStream.getVideoTracks()[0].onended = () => stopCapture();
        } catch (err) { alert("Sharing cancelled."); }
    }

    function stopCapture() {
        if(displayStream) displayStream.getTracks().forEach(t => t.stop());
        localVid.srcObject = null;
        db.ref('screen_share_status').remove();
        document.getElementById('start-share').style.display = 'inline-block';
        document.getElementById('stop-share').style.display = 'none';
    }

    // --- Original Auth & UI Logic (DO NOT CHANGE) ---
    let isSignUp = false;
    function toggleAuthMode() {
        isSignUp = !isSignUp;
        document.getElementById('auth-title').innerText = isSignUp ? "Sign Up" : "Sign In";
        document.getElementById('signup-fields').classList.toggle('hidden');
        document.getElementById('auth-btn').innerText = isSignUp ? "Register" : "Login";
    }

    function handleAuth() {
        const id = document.getElementById('user-id').value.trim();
        const pass = document.getElementById('user-pass').value;
        if(isSignUp) {
            db.ref('users/' + id).set({ password: pass, name: id }).then(() => { alert("Created!"); toggleAuthMode(); });
        } else {
            db.ref('users/' + id).once('value', s => {
                if(s.val() && s.val().password === pass) { localStorage.setItem('active_user', id); location.reload(); }
                else alert("Wrong credentials");
            });
        }
    }

    function logout() { localStorage.clear(); location.reload(); }

    const active = localStorage.getItem('active_user');
    if(active) {
        document.getElementById('auth-screen').classList.add('hidden');
        document.getElementById('main-ui').classList.remove('hidden');
        document.getElementById('display-name').innerText = active;
        document.getElementById('p-name').innerText = active;
        document.getElementById('avatar-icon').innerText = active.charAt(0).toUpperCase();
    }

    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); }
    function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        toggleSidebar();
    }

    // Video & Chat Listeners
    db.ref('live_vid').on('value', s => { document.getElementById('play-btn').href = "https://www.youtube.com/watch?v=" + (s.val() || 'dQw4w9WgXcQ'); });
    function updateLink() {
        const val = document.getElementById('yt-url').value;
        if(val) { db.ref('live_vid').set(val.includes('v=') ? val.split('v=')[1].split('&')[0] : val); document.getElementById('yt-url').value = ""; }
    }

    db.ref('live_chat').limitToLast(15).on('value', snap => {
        const box = document.getElementById('chat-msgs'); box.innerHTML = "";
        snap.forEach(c => { box.innerHTML += `<div class="msg-bubble"><span><b>${c.val().user}:</b> ${c.val().text}</span> <b onclick="deleteMsg('${c.key}')" style="cursor:pointer;color:red;">...</b></div>`; });
        box.scrollTop = box.scrollHeight;
    });

    function sendMsg() {
        const t = document.getElementById('c-text').value;
        if(t) { db.ref('live_chat').push({ text: t, user: active }); document.getElementById('c-text').value = ""; }
    }
    function deleteMsg(k) { if(confirm("Delete?")) db.ref('live_chat/'+k).remove(); }
</script>
</body>
</html>
